<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TableTopTool MVP</title>
    <style>
      body {
      font-family:
        system-ui,
        -apple-system,
        BlinkMacSystemFont,
        "Segoe UI",
        Roboto,
        Oxygen,
        Ubuntu,
        Cantarell,
        "Open Sans",
        "Helvetica Neue",
        sans-serif;
      }
      #vtt-canvas {
        display: block; /* Canvases are inline by default, block can behave better in some layouts */
        width: 100%; /* Occupy full width of parent */
        height: 100%; /* Occupy full height of parent */
        box-sizing: border-box; /* Ensure padding and border don't add to overall dimensions */
      }
    </style>
    <link href="/public/ui.css" rel="stylesheet" >
    <noscript><link rel="stylesheet" href="./public/ui.css"></noscript>
    <link rel="icon" href="/public/favicon.ico" sizes="any" />
    <link rel="icon" type="image/png" sizes="32x32" href="/public/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/public/favicon-16x16.png" />
    <link rel="icon" type="image/png" href="/public/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/public/favicon.svg" />
    <link rel="shortcut icon" href="/public/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/public/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="TableTopTool" />
    <link rel="manifest" href="./site.webmanifest" />
    <meta name="theme-color" content="#ffffff" />
  </head>
  <body class="bg-gray-800 text-white flex flex-col h-screen">
    <!-- Header -->
    <header class="bg-gray-700 p-2 shadow-md flex items-center justify-between">
      <h1 id="header-title" class="text-xl font-bold">TableTopTool</h1>
      <div class="flex items-center space-x-2">
        <span class="text-sm">User: <span id="user-id-display">N/A</span></span>
        <span class="text-sm"
          >Session: <span id="session-id-display">default-session</span></span
        >
        <input
          type="text"
          id="session-load-input"
          placeholder="Session ID to Load"
          class="px-2 py-1 text-sm bg-gray-600 border border-gray-500 rounded"
        />
        <button
          id="session-load-button"
          class="px-3 py-1 text-sm bg-blue-500 hover:bg-blue-600 rounded"
        >
          Load
        </button>
        <button
          id="session-save-button"
          class="px-3 py-1 text-sm bg-green-500 hover:bg-green-600 rounded"
        >
          Save Current Session
        </button>
        <button
          id="clear-board-button"
          class="px-3 py-1 text-sm bg-red-500 hover:bg-red-600 rounded"
        >
          Clear Board
        </button>
        <button
          id="save-memory-state-button"
          class="px-3 py-1 text-sm bg-indigo-500 hover:bg-indigo-600 rounded"
        >
          Save State
        </button>
        <button
          id="load-memory-state-button"
          class="px-3 py-1 text-sm bg-indigo-500 hover:bg-indigo-600 rounded"
        >
          Load State
        </button>
      </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow flex overflow-hidden">
      <!-- Left Sidebar (Tools) -->
      <aside
        id="tools-sidebar"
        class="w-64 bg-gray-700 p-4 space-y-4 overflow-y-auto shadow-lg"
      >
        <h2 class="text-lg font-semibold mb-2">Tools</h2>
        <div>
          <button
            id="create-object-button"
            class="w-full px-3 py-2 text-sm bg-purple-500 hover:bg-purple-600 rounded"
          >
            Create Object
          </button>
        </div>
        <hr class="border-gray-600" />
        <div>
          <h3 class="text-md font-semibold mb-1">Table Background</h3>
          <label for="background-url-input" class="block text-sm mb-1"
            >Image URL:</label
          >
          <div class="flex items-center space-x-2 mb-2">
            <input
              type="text"
              id="background-url-input"
              placeholder="e.g., /assets/map.png"
              class="w-full px-2 py-1 text-sm bg-gray-600 border border-gray-500 rounded"
            />
            <button
              id="choose-background-image-button"
              class="px-3 py-1 text-sm bg-blue-500 hover:bg-blue-600 rounded text-white whitespace-nowrap"
            >
              Choose File
            </button>
          </div>
          <label for="background-color-input" class="block text-sm mb-1"
            >Background Color:</label
          >
          <input
            type="color"
            id="background-color-input"
            value="#cccccc"
            class="w-full h-8 px-1 py-1 bg-gray-600 border border-gray-500 rounded mb-2"
          />
          <button
            id="set-background-button"
            class="w-full px-3 py-2 text-sm bg-teal-500 hover:bg-teal-600 rounded"
          >
            Set Background
          </button>
        </div>
        <!-- Board Dimensions and Scale Section -->
        <div class="mt-4 p-2 bg-gray-700 rounded-md">
          <h4 class="text-md font-semibold mb-2 text-gray-200">Board Setup</h4>

          <!-- Board Width -->
          <div class="mb-2">
            <label
              for="board-width-input"
              class="block text-sm font-medium text-gray-300"
              >Board Width:</label
            >
            <input
              type="number"
              id="board-width-input"
              name="board-width-input"
              value="36"
              class="mt-1 block w-full p-1 bg-gray-600 border border-gray-500 rounded-md text-white shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50 text-sm"
            />
          </div>

          <!-- Board Height -->
          <div class="mb-2">
            <label
              for="board-height-input"
              class="block text-sm font-medium text-gray-300"
              >Board Height:</label
            >
            <input
              type="number"
              id="board-height-input"
              name="board-height-input"
              value="24"
              class="mt-1 block w-full p-1 bg-gray-600 border border-gray-500 rounded-md text-white shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50 text-sm"
            />
          </div>

          <!-- Unit for Board Dimensions -->
          <div class="mb-2">
            <label
              for="board-dimension-unit-input"
              class="block text-sm font-medium text-gray-300"
              >Unit for Board Dimensions:</label
            >
            <select
              id="board-dimension-unit-input"
              name="board-dimension-unit-input"
              class="mt-1 block w-full p-1 bg-gray-600 border border-gray-500 rounded-md text-white shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50 text-sm"
            >
              <option value="in" selected>inches</option>
              <option value="ft">feet</option>
              <option value="m">meters</option>
              <option value="cm">cm</option>
              <option value="mm">mm</option>
            </select>
          </div>

          <p class="mt-2 text-xs text-gray-400">
            Internal base unit: 1 pixel represents 1mm on the map.
          </p>

          <details class="mt-2 bg-gray-600 p-2 rounded-md">
            <summary
              class="text-sm font-medium text-gray-300 cursor-pointer hover:text-white"
            >
              Map Measurement Scale (Optional)
            </summary>
            <p class="text-xs text-gray-400 mt-1 mb-2">
              Define how drawn map units translate to game-world distances
              (e.g., for measurement tools). This does not change the board's
              visual size.
            </p>

            <!-- Board Scale Value -->
            <div class="mb-2 mt-2">
              <label
                for="board-scale-input"
                class="block text-sm font-medium text-gray-300"
                >1 Map Unit = X of Selected Unit:</label
              >
              <input
                type="number"
                id="board-scale-input"
                name="board-scale-input"
                value="1"
                class="mt-1 block w-full p-1 bg-gray-500 border border-gray-400 rounded-md text-white shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50 text-sm"
                title="e.g., if map is 1 inch = 5 feet, enter 5 if 'feet' is selected below. If 1:1, enter 1."
              />
            </div>

            <!-- Board Scale Unit -->
            <div class="mb-2">
              <label
                for="board-scale-unit-input"
                class="block text-sm font-medium text-gray-300"
                >Unit for Measurement Scale:</label
              >
              <select
                id="board-scale-unit-input"
                name="board-scale-unit-input"
                class="mt-1 block w-full p-1 bg-gray-500 border border-gray-400 rounded-md text-white shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50 text-sm"
              >
                <option value="in">inches (e.g., 1 map unit = X inches)</option>
                <option value="ft">feet (e.g., 1 map unit = X feet)</option>
                <option value="m">meters (e.g., 1 map unit = X meters)</option>
                <option value="cm">cm (e.g., 1 map unit = X cm)</option>
                <option value="mm" selected>
                  mm (e.g., 1 map unit = X mm)
                </option>
              </select>
            </div>
          </details>

          <!-- Effective Size Display (Optional, can be populated by JS) -->
          <div class="mb-2 mt-2">
            <p class="text-sm text-gray-400">
              Effective Board Size (pixels):
              <span id="effective-board-size-display">N/A</span>
            </p>
          </div>

          <button
            id="apply-board-properties-button"
            class="w-full mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md shadow-sm text-sm"
          >
            Apply Board Properties
          </button>
        </div>
      </aside>

      <!-- Canvas Container -->
      <section
        id="canvas-container"
        class="flex-grow bg-gray-600 flex items-center justify-center relative overflow-hidden"
      >
        <canvas id="vtt-canvas" class="border border-black"></canvas>
      </section>

      <!-- Right Sidebar (Inspector) -->
      <aside
        id="inspector-sidebar"
        class="w-72 bg-gray-700 p-4 space-y-3 overflow-y-auto shadow-lg"
      >
        <h2 class="text-lg font-semibold mb-2">Inspector</h2>
        <div id="inspector-content" class="space-y-2">
          <p class="text-sm text-gray-400">Select an object to inspect.</p>
          <!-- Inspector fields will be populated by ui.js -->
          <!-- Example fields (some might be hidden/shown based on selection) -->
          <div>
            <label class="block text-sm"
              >ID: <span id="obj-id" class="font-mono text-xs"></span
            ></label>
          </div>
          <div>
            <label for="obj-name" class="block text-sm"
              >Name:
              <input
                type="text"
                id="obj-name"
                class="prop-input w-full p-1 border rounded bg-gray-700 border-gray-600 text-white"
            /></label>
          </div>
          <div>
            <label for="obj-x" class="block text-sm"
              >X: <input type="number" id="obj-x" class="w-full prop-input"
            /></label>
          </div>
          <div>
            <label for="obj-y" class="block text-sm"
              >Y: <input type="number" id="obj-y" class="w-full prop-input"
            /></label>
          </div>
          <div>
            <label for="obj-width" class="block text-sm"
              >Width:
              <input type="number" id="obj-width" class="w-full prop-input"
            /></label>
          </div>
          <div>
            <label for="obj-height" class="block text-sm"
              >Height:
              <input type="number" id="obj-height" class="w-full prop-input"
            /></label>
          </div>
          <div>
            <label for="obj-rotation" class="block text-sm"
              >Rotation:
              <input
                type="number"
                id="obj-rotation"
                class="w-full prop-input"
                step="1"
            /></label>
          </div>
          <div>
            <label for="obj-bg-color" class="block text-sm"
              >Background Color:
              <input
                type="color"
                id="obj-bg-color"
                class="w-full h-8 prop-input"
            /></label>
          </div>
          <div>
            <label for="obj-image-url" class="block text-sm"
              >Image URL:
              <input type="text" id="obj-image-url" class="w-full prop-input"
            /></label>
          </div>
          <button
            id="choose-object-image-button"
            class="w-full px-3 py-2 text-sm bg-blue-500 hover:bg-blue-600 rounded mt-1"
          >
            Choose Local Image
          </button>
          <input
            type="file"
            id="objectImageFileInput"
            accept="image/*"
            style="display: none"
          />
          <div class="mb-2">
            <label
              for="obj-label-text"
              class="block text-sm font-medium text-gray-300"
              >Label Text:</label
            >
            <input
              type="text"
              id="obj-label-text"
              class="prop-input mt-1 block w-full p-1 border rounded bg-gray-700 border-gray-600 text-white shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
            />
          </div>
          <div class="mb-2 flex items-center">
            <input
              type="checkbox"
              id="obj-show-label"
              class="prop-input h-4 w-4 text-indigo-600 border-gray-600 rounded bg-gray-700 focus:ring-indigo-500"
            />
            <label for="obj-show-label" class="ml-2 block text-sm text-gray-300"
              >Show Label</label
            >
          </div>
          <div>
            <label for="obj-z-index" class="block text-sm"
              >Z-Index:
              <input type="number" id="obj-z-index" class="w-full prop-input"
            /></label>
          </div>
          <div>
            <label for="obj-is-movable" class="block text-sm"
              >Is Movable:
              <input
                type="checkbox"
                id="obj-is-movable"
                class="prop-input align-middle"
              />
            </label>
          </div>
          <div>
            <label for="obj-shape" class="block text-sm"
              >Shape:
              <select
                id="obj-shape"
                class="w-full prop-input bg-gray-600 border border-gray-500 rounded p-1 text-sm"
              >
                <option value="rectangle">Rectangle</option>
                <option value="circle">Circle</option>
              </select>
            </label>
          </div>
          <hr class="border-gray-600" />
          <div>
            <label for="obj-data" class="block text-sm"
              >Custom Data (JSON):</label
            >
            <textarea
              id="obj-data"
              rows="3"
              class="w-full prop-input text-xs"
            ></textarea>
          </div>
          <div>
            <label for="obj-script-onclick" class="block text-sm"
              >Script - onClick:</label
            >
            <textarea
              id="obj-script-onclick"
              rows="3"
              class="w-full prop-input text-xs"
            ></textarea>
          </div>
          <style>
            .prop-input {
              background-color: #4a5568;
              border: 1px solid #718096;
              border-radius: 0.25rem;
              padding: 0.25rem 0.5rem;
              font-size: 0.875rem;
            }
          </style>
        </div>
        <div id="inspector-actions" class="mt-4 space-y-2 hidden">
          <button
            id="update-object-button"
            class="w-full px-3 py-2 text-sm bg-green-500 hover:bg-green-600 rounded"
          >
            Apply Changes
          </button>
          <button
            id="delete-object-button"
            class="w-full px-3 py-2 text-sm bg-red-500 hover:bg-red-600 rounded"
          >
            Delete Object
          </button>
        </div>
      </aside>
    </main>

    <!-- Modal Container (Initially Hidden) -->
    <div
      id="modal-container"
      class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50"
    >
      <div class="bg-gray-700 p-6 rounded-lg shadow-xl max-w-md w-full">
        <h3 id="modal-title" class="text-xl font-semibold mb-4">Modal Title</h3>
        <div id="modal-content" class="mb-6">
          <p>Modal content goes here...</p>
        </div>
        <div id="modal-buttons" class="flex justify-end space-x-3">
          <!-- Buttons added by ui.js -->
        </div>
      </div>
    </div>

    <!-- Message Area -->
    <div id="message-area" class="fixed bottom-4 right-4 space-y-2 z-40">
      <!-- Messages will be added here by ui.js -->
    </div>

    <script type="module" src="./main.js"></script>
  </body>
</html>
